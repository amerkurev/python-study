<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn about the role of return in generator functions, the advantages of yield from, how to create decorators for generators, and more in this practical article."><title>Subtle Aspects of Python's Generator Function</title><link rel=canonical href=https://python.study/p/subtle-aspects-of-pythons-generator-function/><link rel=stylesheet href=/scss/style.min.1594ac3e17fd0bdba91fff49adf83d23c424563c68a6b2dc7b30569a15c87161.css><meta property="og:title" content="Subtle Aspects of Python's Generator Function"><meta property="og:description" content="Learn about the role of return in generator functions, the advantages of yield from, how to create decorators for generators, and more in this practical article."><meta property="og:url" content="https://python.study/p/subtle-aspects-of-pythons-generator-function/"><meta property="og:site_name" content="Python Study"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="generator"><meta property="article:tag" content="yield"><meta property="article:tag" content="decorator"><meta property="article:tag" content="async for"><meta property="article:published_time" content="2023-09-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-04T00:00:00+00:00"><meta property="og:image" content="https://python.study/p/subtle-aspects-of-pythons-generator-function/cover.jpeg"><meta name=twitter:title content="Subtle Aspects of Python's Generator Function"><meta name=twitter:description content="Learn about the role of return in generator functions, the advantages of yield from, how to create decorators for generators, and more in this practical article."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://python.study/p/subtle-aspects-of-pythons-generator-function/cover.jpeg"><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-RTW8ER847W"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-RTW8ER847W",{anonymize_ip:!1})}</script><style>:root{--code-font-family:"Source Code Pro", Menlo, Monaco, Consolas, "Courier New", monospace}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/python-logo_hu59f4995e8b59f3a82a1e6b1c1b24787b_150090_300x0_resize_box_3.png width=300 height=299 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Python Study</a></h1><h2 class=site-description>Study Python in-depth through concise and interesting posts.</h2></div></header><ol class=social-menu><li><a href=https://github.com/amerkurev/python-study target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/amerkurev target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://medium.com/@apps.merkurev target=_blank title=Medium rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-medium" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 9h1l3 3 3-3h1"/><path d="M8 15h2"/><path d="M14 15h2"/><path d="M9 9v6"/><path d="M15 9v6"/></svg></a></li><li><a href=https://python.study/index.xml target=_blank title=RSS rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://t.me/pystudy target=_blank title=Telegram rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/writing/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-writing" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 17V5c0-1.121-.879-2-2-2s-2 .879-2 2v12l2 2 2-2z"/><path d="M16 7h4"/><path d="M18 19H5a2 2 0 110-4h4a2 2 0 100-4H6"/></svg><span>Write a post</span></a></li><li><a href=/subscribe/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M16 19h6"/><path d="M19 16v6"/><path d="M6 21v-2a4 4 0 014-4h4"/></svg><span>Subscribe to us</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/subtle-aspects-of-pythons-generator-function/><img src=/p/subtle-aspects-of-pythons-generator-function/cover_hu5af12b01eb0664f374c4a5aeb2956b3a_132976_800x0_resize_q75_box.jpeg srcset="/p/subtle-aspects-of-pythons-generator-function/cover_hu5af12b01eb0664f374c4a5aeb2956b3a_132976_800x0_resize_q75_box.jpeg 800w, /p/subtle-aspects-of-pythons-generator-function/cover_hu5af12b01eb0664f374c4a5aeb2956b3a_132976_1600x0_resize_q75_box.jpeg 1600w" width=800 height=795 loading=lazy alt="Featured image of post Subtle Aspects of Python's Generator Function"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/subtle-aspects-of-pythons-generator-function/>Subtle Aspects of Python's Generator Function</a></h2><h3 class=article-subtitle>Learn about the role of return in generator functions, the advantages of yield from, how to create decorators for generators, and more in this practical article.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 04, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><a href=/tags/generator/>generator</a>
<a href=/tags/yield/>yield</a>
<a href=/tags/decorator/>decorator</a>
<a href=/tags/async-for/>async for</a></div></footer></div></header><section class=article-content><p>Any function in Python that contains the keyword <code>yield</code> is called a <strong>generator function</strong>.
When called, a generator function returns a <strong>generator object</strong> that &ldquo;wraps&rdquo; the body of the function.
When an object of the generator is passed to the <code>next()</code> function, execution continues until the next <code>yield</code> statement in the function body, and the value associated with that <code>yield</code> is returned.
When the function exits, the generator object raises a <code>StopIteration</code> exception according to the Iterator protocol.
Therefore, a generator function can be used wherever an iterator can be used, such as in loops.</p><p>Let&rsquo;s consider an example of a generator function called <strong>finder</strong> that searches for a specific string in Python source code files (files with the extension <code>*.py</code>).
The string can be represented by a regular expression.
In addition to the search string, our generator function will also take the path to the directory containing the code.</p><p>The example code for the <strong>finder</strong> generator function is shown below.
Note that <strong>finder</strong> uses another generator function called <strong>search</strong> to determine the line number where a match was found.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=n>re</span><span class=o>.</span><span class=n>Pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>fd</span><span class=o>.</span><span class=n>readlines</span><span class=p>(),</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>num</span>  <span class=c1># line number in the file where a match was found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>finder</span><span class=p>(</span><span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>src_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>iglob</span><span class=p>(</span><span class=s1>&#39;**/*.py&#39;</span><span class=p>,</span> <span class=n>root_dir</span><span class=o>=</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>it</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line_num</span> <span class=ow>in</span> <span class=n>search</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>_pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>path</span><span class=p>,</span> <span class=n>line_num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gen_obj</span> <span class=o>=</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 3)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 23)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generator is an iterator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections.abc</span> <span class=kn>import</span> <span class=n>Iterator</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>,</span> <span class=n>Iterator</span><span class=p>))</span>  <span class=c1># True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ...which means that a generator function can be used in a loop</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;file </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s1>, line </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output in the loop:</span>
</span></span><span class=line><span class=cl><span class=c1># file ./example.py, line 3</span>
</span></span><span class=line><span class=cl><span class=c1># file ./example.py, line 23</span>
</span></span><span class=line><span class=cl><span class=c1># and so on...</span>
</span></span></code></pre></div><p>In this example, we will explore some subtle aspects of using generator functions.</p><h2 id=return>return</h2><p>In the example, the return from the generator function happens implicitly (there is no explicit <code>return</code> statement).
The question arises: what if there is an explicit return statement that returns a value?
How can the calling code access this returned value?</p><p>It turns out that the returned value will be passed to the <code>value</code> field of the <code>StopIteration</code> exception!
Let&rsquo;s modify our generator function code to return the total number of matches found and print it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=n>re</span><span class=o>.</span><span class=n>Pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>fd</span><span class=o>.</span><span class=n>readlines</span><span class=p>(),</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>num</span>  <span class=c1># line number in the file where a match was found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>finder</span><span class=p>(</span><span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>src_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>iglob</span><span class=p>(</span><span class=s1>&#39;**/*.py&#39;</span><span class=p>,</span> <span class=n>root_dir</span><span class=o>=</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>it</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line_num</span> <span class=ow>in</span> <span class=n>search</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>_pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>path</span><span class=p>,</span> <span class=n>line_num</span>
</span></span><span class=line><span class=cl>            <span class=n>total</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># explicit return statement in the function</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>total</span>  <span class=c1># total number of matches found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gen_obj</span> <span class=o>=</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>StopIteration</span> <span class=k>as</span> <span class=n>ctx</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># the returned value is stored in the value field of </span>
</span></span><span class=line><span class=cl>    <span class=c1># the StopIteration exception</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ctx</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>  <span class=c1># total number of matches found</span>
</span></span></code></pre></div><p>Doing the same thing in a <code>for</code> loop is not possible because the <code>StopIteration</code> exception will be implicitly caught and handled.
In other words, we won&rsquo;t have access to it.</p><p>In fact, an explicit return statement with a value is very rare in generator functions and is mostly used for debugging purposes.</p><h2 id=yield-from>yield from</h2><p>Let&rsquo;s pay attention to the <code>yield</code> statement in the code of the generator function <strong>finder</strong> - it is located inside a loop.
The call to the generator function <strong>search</strong> returns a generator object, which is essentially an iterator that we iterate over in this loop.
In our case, we need to get everything that this iterator yields.
To achieve this, we don&rsquo;t need the loop at all; it is enough to use the <code>yield from</code> statement.
Let&rsquo;s rewrite the code of the generator function <strong>finder</strong> by adding <code>yield from</code> and removing the explicit loop over the iterator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>repeat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=n>re</span><span class=o>.</span><span class=n>Pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>fd</span><span class=o>.</span><span class=n>readlines</span><span class=p>(),</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>num</span>  <span class=c1># line number in the file where a match was found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>finder</span><span class=p>(</span><span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>src_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>iglob</span><span class=p>(</span><span class=s1>&#39;**/*.py&#39;</span><span class=p>,</span> <span class=n>root_dir</span><span class=o>=</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>it</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>yield from</span> <span class=nb>zip</span><span class=p>(</span><span class=n>repeat</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=n>search</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>_pattern</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gen_obj</span> <span class=o>=</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 3)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 5)</span>
</span></span></code></pre></div><p>The expression <code>zip(repeat(path), search(path, _pattern))</code> may look cumbersome, but that&rsquo;s because our generator yields a tuple value - the file path and the line number where a match was found.
While the search generator yields line numbers, the path remains the same.
We can easily get a sequence of identical paths using the <code>repeat</code> iterator from the <code>itertools</code> module.
The <code>zip</code> function is used to yield tuples of values.
With the help of the <code>itertools</code> module and functions like <code>zip</code>, Python allows us to write code in a functional style.</p><p>However, it is important to keep the code understandable for others.
We could have shortened the <strong>finder</strong> generator function to just one line (🤯), but it would have been extremely difficult to understand.
Here&rsquo;s an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>repeat</span><span class=p>,</span> <span class=n>chain</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=n>re</span><span class=o>.</span><span class=n>Pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>fd</span><span class=o>.</span><span class=n>readlines</span><span class=p>(),</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>num</span>  <span class=c1># line number in the file where a match was found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>finder</span><span class=p>(</span><span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>src_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>yield from</span> <span class=n>chain</span><span class=o>.</span><span class=n>from_iterable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nb>zip</span><span class=p>(</span><span class=n>repeat</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=n>search</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>glob</span><span class=o>.</span><span class=n>iglob</span><span class=p>(</span><span class=s1>&#39;**/*.py&#39;</span><span class=p>,</span> <span class=n>root_dir</span><span class=o>=</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>  <span class=c1># better not to write like this!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gen_obj</span> <span class=o>=</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 3)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=n>gen_obj</span><span class=p>))</span>  <span class=c1># (&#39;./example.py&#39;, 5)</span>
</span></span></code></pre></div><h2 id=decorator>decorator</h2><p>Applying a decorator to a generator function gives an unexpected result.
The decorator does not wrap the body of the generator function.
The decorator is executed when the generator function is called, and at this stage, only the generator object is created.
Therefore, for example, if we try to measure the execution time of a generator function, we will only get the time it takes to create the generator itself.
The simple example below demonstrates this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>timeit</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>elapsed</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>t</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;elapsed </span><span class=si>{</span><span class=n>elapsed</span><span class=si>:</span><span class=s1>0.8f</span><span class=si>}</span><span class=s1>s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@timeit</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>simple_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>simple_func</span><span class=p>()</span>  <span class=c1># output something like &#34;elapsed 1.00515067s&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@timeit</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=p>(</span><span class=n>gen_func</span><span class=p>())</span>  <span class=c1># output something like &#34;elapsed 0.00001092s&#34;</span>
</span></span></code></pre></div><p>In this example, the <code>timeit</code> decorator, which wraps the generator function <code>gen_func</code>, is not very useful.
However, it is possible to write a decorator for a generator function.
For example, we can rewrite <code>timeit</code> like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>timeit</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>yield from</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>elapsed</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span> <span class=o>-</span> <span class=n>t</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;elapsed </span><span class=si>{</span><span class=n>elapsed</span><span class=si>:</span><span class=s1>0.8f</span><span class=si>}</span><span class=s1>s&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>wrapper</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@timeit</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=p>(</span><span class=n>gen_func</span><span class=p>())</span>  <span class=c1># output something like &#34;elapsed 2.00686138s&#34;</span>
</span></span></code></pre></div><h2 id=async-generator>async generator</h2><p>A generator function can be asynchronous, in which case it will create asynchronous generators (<code>async_generator</code>).
To work with asynchronous generators in Python, there is the <code>async for</code> construct.
Let&rsquo;s rewrite our generator function <strong>finder</strong> in an asynchronous form, using <code>async for</code> to work with the generator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>asyncio</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>search</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>pattern</span><span class=p>:</span> <span class=n>re</span><span class=o>.</span><span class=n>Pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>fd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>num</span><span class=p>,</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>fd</span><span class=o>.</span><span class=n>readlines</span><span class=p>(),</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>pattern</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>num</span>  <span class=c1># line number in the file where a match was found</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>finder</span><span class=p>(</span><span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>src_dir</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>iglob</span><span class=p>(</span><span class=s1>&#39;**/*.py&#39;</span><span class=p>,</span> <span class=n>root_dir</span><span class=o>=</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>it</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src_dir</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>for</span> <span class=n>line_num</span> <span class=ow>in</span> <span class=n>search</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>_pattern</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>path</span><span class=p>,</span> <span class=n>line_num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>finder</span><span class=p>(</span><span class=s1>&#39;import re&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;file </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s1>, line </span><span class=si>{</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</span></span></code></pre></div><p>It was not difficult to rewrite the generator function as an asynchronous one.</p><h2 id=coroutines>coroutines</h2><p>In <a class=link href=https://peps.python.org/pep-0342/ target=_blank rel=noopener>PEP 342 &ldquo;Coroutines via Enhanced Generators&rdquo;</a> it is stated that generators can be used as coroutines.
For this purpose, generators have special methods such as <code>.send()</code> and <code>.throw()</code>, and the <code>yield</code> statement not only yields values but also consumes them.
When you see such usage of a generator function, know that it is a coroutine.
And a coroutine is not an iterator!
Coroutines have nothing to do with iteration.</p><p>Moreover, with the advent of <code>asyncio</code>, the use of generators as coroutines becomes almost obsolete.
Nevertheless, it is important to be able to recognize a &ldquo;classic&rdquo; coroutine in the code to understand that it is not about iteration.
Let&rsquo;s provide an example of such a coroutine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>adder</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=k>yield</span> <span class=n>acc</span>
</span></span><span class=line><span class=cl>        <span class=n>acc</span> <span class=o>+=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>coro_add</span> <span class=o>=</span> <span class=n>adder</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>next</span><span class=p>(</span><span class=n>coro_add</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>coro_add</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>  <span class=c1>#  1 (0 + 1)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>coro_add</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>2</span><span class=p>))</span>  <span class=c1>#  3 (1 + 2)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>coro_add</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>  <span class=c1>#  6 (3 + 3)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>coro_add</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>  <span class=c1># 10 (6 + 4)</span>
</span></span></code></pre></div><p>Pay attention to the <code>yield</code> statement.
In this case, <code>yield</code> not only yields the value of <code>acc</code> but also accepts a value that is passed through the <code>send</code> method call.
Coroutines consume data, while iterators produce data.
Even though both cases use the <code>yield</code> keyword, they are two completely different uses of generator functions.</p><p>That&rsquo;s all for now.</p><p>Additional information about generator functions and generators can be found in the following documents:</p><ul><li><a class=link href=https://peps.python.org/pep-0255/ target=_blank rel=noopener>PEP 255 – Simple Generators</a></li><li><a class=link href=https://peps.python.org/pep-0342/ target=_blank rel=noopener>PEP 342 – Coroutines via Enhanced Generators</a></li><li><a class=link href=https://peps.python.org/pep-0380/ target=_blank rel=noopener>PEP 380 – Syntax for Delegating to a Subgenerator</a></li><li><a class=link href=https://peps.python.org/pep-0479/ target=_blank rel=noopener>PEP 479 – Change StopIteration handling inside generators</a></li></ul></section><footer class=article-footer><br><div><a target=_blank href=https://github.com/amerkurev/python-study/issues/new><small>Please report any mistakes and shortcomings by opening an issue on GitHub.</small></a></div></footer></article><div class="article-list--compact links"><article><a href=https://github.com/amerkurev target=_blank rel=noopener><div class=article-details><h2 class=article-title>Posted by amerkurev</h2><footer class=article-time>https://github.com/amerkurev</footer></div><div class=article-image><img src="https://avatars.githubusercontent.com/u/28217522?v=4" loading=lazy></div></a></article></div><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Python Study</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>